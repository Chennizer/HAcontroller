<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contrôleur Adaptatech</title>
  <style>
    html, body {height: 100%; margin: 0; background: #0b0b0b; display: grid; place-items: center; color: white;}
    button {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      padding: 1rem 2rem;
      border: none;
      border-radius: 20px;
      background: #294936;
      color: white;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    button:active { transform: scale(0.97); }
  </style>
</head>
<body>

  <button id="activate">Activer le jouet</button>

 <script>
  const HA_URL = "https://haintelligentclassroom.adaptatech.org";
  const WEBHOOK_ID = "toy_relay";

  // Tiny HUD
  const hud = document.createElement('pre');
  hud.style.position = 'fixed';
  hud.style.bottom = '12px';
  hud.style.left   = '12px';
  hud.style.maxWidth = '80vw';
  hud.style.maxHeight = '40vh';
  hud.style.overflow = 'auto';
  hud.style.padding = '10px 12px';
  hud.style.background = 'rgba(0,0,0,.6)';
  hud.style.borderRadius = '10px';
  hud.style.font = '12px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace';
  hud.style.color = '#fff';
  hud.textContent = 'ready';
  document.body.appendChild(hud);
  const log = (...args) => { console.log(...args); hud.textContent = args.map(x => String(x)).join(' '); };

  async function triggerToy() {
    try {
      const url = `${HA_URL}/api/webhook/${WEBHOOK_ID}?t=${Date.now()}`;
      log('sending →', url);
      const res = await fetch(url, {
        method: "POST",         // no headers = no CORS preflight
        redirect: "follow",     // show us if CF is redirecting/challenging
        cache: "no-store",
        credentials: "omit"
      });
      const text = await res.text();
      log(`status ${res.status} @ ${res.url}\n${text.slice(0,200)}`);
      if (!res.ok) alert(`Erreur: ${res.status}`);
    } catch (e) {
      log('network error →', e?.message || e);
      alert("Impossible de joindre Home Assistant");
    }
  }

  const btn = document.getElementById("activate");
  if (btn) {
    btn.addEventListener("click", triggerToy);
    log('handler attached');
  } else {
    log('ERROR: button not found');
  }

  window.addEventListener('error', (e) => console.error('JS error:', e.message));
</script>



</body>
</html>
